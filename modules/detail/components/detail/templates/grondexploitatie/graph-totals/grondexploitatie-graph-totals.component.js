import ReactDOM from 'react-dom'

angular.module('dpDetail').component('dpGrondexploitatieGraphTotals', {
  bindings: {
    data: '<',
    hasSecondaryTitle: '<',
  },
  templateUrl:
    'modules/detail/components/detail/templates/grondexploitatie/graph-totals/grondexploitatie-graph-totals.html', //eslint-disable-line
  controller: DpGrondexploitatieGraphTotals,
  controllerAs: 'vm',
})

DpGrondexploitatieGraphTotals.$inject = ['$timeout', '$window']

function DpGrondexploitatieGraphTotals($timeout, $window) {
  const vm = this

  const { React } = $window
  const { render } = $window
  const GraphWrapper = $window.DetailGrondexploitatieGraphTotalsWrapper
  let graphNode

  const mountReactComponents = (data, hasSecondaryTitle) => {
    graphNode = document.getElementById('detail-grondexploitatie-graph-totals')
    /* istanbul ignore next */

    if (graphNode) {
      render(React.createElement(GraphWrapper, { data, hasSecondaryTitle }), graphNode)
    }
  }

  $timeout(() => {
    mountReactComponents(vm.data, vm.hasSecondaryTitle)
  })

  this.$onDestroy = () => {
    if (graphNode) {
      ReactDOM.unmountComponentAtNode(graphNode)
    }
  }
}
